{"version":3,"sources":["webpack:////Users/elliott/Desktop/dubbingStr2.0/components/tui-chat/message-list/index.vue?8dd1","webpack:////Users/elliott/Desktop/dubbingStr2.0/components/tui-chat/message-list/index.vue?cfe2","webpack:////Users/elliott/Desktop/dubbingStr2.0/components/tui-chat/message-list/index.vue?e4fc","webpack:////Users/elliott/Desktop/dubbingStr2.0/components/tui-chat/message-list/index.vue?6b5f","uni-app:///components/tui-chat/message-list/index.vue","webpack:////Users/elliott/Desktop/dubbingStr2.0/components/tui-chat/message-list/index.vue?7e01"],"names":["renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped"],"mappings":";;;;2DAAA,wQACIA,EADJ,qMASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,6CACZ,aAAAF,E;;;;2GCvBf,0yC;;;;2GCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G;;;;2DCRvB,04BAAm1B,eAAG,G;;;;o6GCoDt1B,CACE,KADF,WAEI,MAAJ,CACM,OAAN,GACM,OAAN,GAEM,YAAN,GAEM,WAAN,GACM,UAAN,EACM,WAAN,EACM,iBAAN,GAEM,aAAN,IAKE,WAAF,CACI,eAAJ,EACI,gBAAJ,EACI,gBAAJ,EACI,gBAAJ,EACI,iBAAJ,EACI,cAAJ,EACI,iBAAJ,EACI,eAAJ,EACI,eAAJ,GAEE,MAAF,CACI,aAAJ,CACM,KAAN,OACM,QAAN,eAGE,MAAF,CACI,aAAJ,CACM,QAAN,uBACA,kBACQ,KAAR,SACU,aAAV,IACQ,WACE,EAAV,sBAGM,WAAN,EACM,MAAN,IAGE,QAjDF,WAiDA,WACI,EAAJ,yCACM,EAAN,qBACM,EAAN,wBAEI,EAAJ,yEACI,EAAJ,gFAGE,UA1DF,WA4DI,EAAJ,sEAEE,QAAF,CACI,QADJ,WACA,WACA,iBACQ,KAAR,SACU,aAAV,EACU,WAAV,KAIM,KAAN,kCACM,YAAN,WACQ,EAAR,SACU,WAAV,MAEA,OAGI,eAjBJ,SAiBA,cACA,kBACQ,EAAR,wBACU,eAAV,iBACU,iBAAV,sBACU,MAAV,KACQ,MAAR,gBAEU,EACA,EAAV,KADA,YAEU,EAAV,yCACU,EAAV,+BACU,EAAV,6CACU,EAAV,0CAMI,kBApCJ,SAoCA,GACM,KAAN,+CACM,KAAN,kBAII,qBA1CJ,WA2CM,KAAN,SACQ,YAAR,oBAGI,eA/CJ,WA+CA,WACA,mCACA,8BACM,EAAN,gCACQ,EAAR,sBAEU,EAAV,yBAEA,QAGI,mBA1DJ,SA0DA,cAEA,IACA,KACM,EAAN,0BACA,kDACU,EAAV,0BAGM,KAAN,uCACM,KAAN,kBAII,qBAxEJ,SAwEA,cACA,aACQ,KAAR,SACU,YAAV,IACQ,eACA,KAAR,sBAEU,EAAV,sB;;;;2DCjMA,uvCAAgsC,eAAG,G","file":"components/tui-chat/message-list/index.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=6909c48e&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/tui-chat/message-list/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=6909c48e&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\n    <scroll-view class=\"message-list-container\"\n                 scroll-y=\"true\"\n                 :scroll-into-view=\"scrollView\"\n                 :refresher-enabled=\"true\"\n                 @refresherrefresh=\"refresh\"\n                 :scroll-top=\"scrollTop\"\n                 :refresher-triggered=\"triggered\">\n        <view id=\"message-scroll\" style=\"width:100%\">\n            <view class=\"no-message\" v-if=\"isCompleted\">没有更多啦</view>\n            <view v-for=\"item in messageList\" :key=\"item.ID\" class=\"t-message\">\n                <view  v-if=\"conversation.type !== '@TIM#SYSTEM'\" :id=\"item.ID\">\n                    <view class=\"t-message-item\">\n                        <TUI-TipMessage v-if=\"item.type === 'TIMGroupTipElem'\" :message=\"item\"></TUI-TipMessage>\n                        <view v-if=\"item.type !== 'TIMGroupTipElem'\" :class=\"item.flow==='out'? 't-self-message':'t-recieve-message'\">\n                            <image class=\"t-message-avatar\" v-if=\"item.flow==='in'\" :src=\"item.avatar || 'https://sdk-web-1252463788.cos.ap-hongkong.myqcloud.com/component/TUIKit/assets/avatar_21.png'\"></image>\n                            <view class=\"read-receipts\" v-if=\"conversation.type === 'C2C' && item.flow==='out'\">\n                                <view v-if=\"item.isPeerRead\">已读</view>\n                                <view v-else>未读</view>\n                            </view>\n                            <view>\n                                <TUI-TextMessage v-if=\"item.type === 'TIMTextElem'\" :message=\"item\" :isMine=\"item.flow==='out'\"></TUI-TextMessage>\n                                <TUI-ImageMessage v-if=\"item.type === 'TIMImageElem'\" :message=\"item\" :isMine=\"item.flow==='out'\"></TUI-ImageMessage>\n                                <TUI-VideoMessage v-if=\"item.type === 'TIMVideoFileElem'\" :message=\"item\" :isMine=\"item.flow==='out'\"></TUI-VideoMessage>\n                                <TUI-AudioMessage v-if=\"item.type === 'TIMSoundElem'\" :message=\"item\" :isMine=\"item.flow==='out'\"></TUI-AudioMessage>\n                                <TUI-CustomMessage v-if=\"item.type === 'TIMCustomElem'\" :message=\"item\" :isMine=\"item.flow==='out'\"></TUI-CustomMessage>\n                                <TUI-FaceMessage v-if=\"item.type === 'TIMFaceElem'\" :message=\"item\" :isMine=\"item.flow==='out'\"></TUI-FaceMessage>\n                                <TUI-FileMessage v-if=\"item.type === 'TIMFileElem'\" :message=\"item\" :isMine=\"item.flow==='out'\"></TUI-FileMessage>\n                            </view>\n                            <image class=\"t-message-avatar\" v-if=\"item.flow==='out'\" :src=\"item.avatar || 'https://sdk-web-1252463788.cos.ap-hongkong.myqcloud.com/component/TUIKit/assets/avatar_21.png'\"></image>\n                        </view>\n                    </view>\n                </view>\n                <view  v-else :id=\"item.ID\" :data-value=\"item.ID\">\n                    <TUI-SystemMessage :message=\"item\"></TUI-SystemMessage>\n                </view>\n            </view>\n        </view>\n    </scroll-view>\n</template>\n\n<script>\n  import TUITextMessage from \"../message-elements/text-message/index\";\n  import TUIImageMessage from \"../message-elements/image-message/index\";\n  import TUIVideoMessage from \"../message-elements/video-message/index\";\n  import TUIAudioMessage from \"../message-elements/audio-message/index\";\n  import TUICustomMessage from \"../message-elements/custom-message/index\";\n  import TUITipMessage from \"../message-elements/tip-message/index\";\n  import TUISystemMessage from \"../message-elements/system-message/index\";\n  import TUIFaceMessage from \"../message-elements/face-message/index\";\n  import TUIFileMessage from \"../message-elements/file-message/index\";\n\n  export default {\n    data() {\n      return {\n        avatar: '',\n        userID: '',\n        // 当前会话\n        messageList: [],\n        // 自己的 ID 用于区分历史消息中，哪部分是自己发出的\n        scrollView: '',\n        scrollTop: 0,\n        triggered: true,\n        nextReqMessageID: '',\n        // 下一条消息标志\n        isCompleted: false // 当前会话消息是否已经请求完毕\n        ,\n      };\n    },\n\n    components: {\n      TUITextMessage,\n      TUIImageMessage,\n      TUIVideoMessage,\n      TUIAudioMessage,\n      TUICustomMessage,\n      TUITipMessage,\n      TUISystemMessage,\n      TUIFaceMessage,\n      TUIFileMessage\n    },\n    props: {\n      conversation: {\n        type: Object,\n        default: () => {}\n      }\n    },\n    watch: {\n      conversation: {\n        handler: function (newVal) {\n          if (!newVal.conversationID) return;\n          this.setData({\n            conversation: newVal\n          }, () => {\n            this.getMessageList(newVal);\n          });\n        },\n        immediate: true,\n        deep: true\n      }\n    },\n    mounted() {\n      uni.$TUIKit.getMyProfile().then(res => {\n        this.avatar = res.data.avatar;\n        this.userID = res.data.userID;\n      });\n      uni.$TUIKit.on(uni.$TUIKitEvent.MESSAGE_RECEIVED, this.$onMessageReceived, this);\n      uni.$TUIKit.on(uni.$TUIKitEvent.MESSAGE_READ_BY_PEER, this.$onMessageReadByPeer, this);\n    },\n\n    destroyed() {\n      // 一定要解除相关的事件绑定\n      uni.$TUIKit.off(uni.$TUIKitEvent.MESSAGE_RECEIVED, this.$onMessageReceived);\n    },\n    methods: {\n      refresh() {\n        if (this.isCompleted) {\n          this.setData({\n            isCompleted: true,\n            triggered: false\n          });\n          return;\n        }\n        this.getMessageList(this.conversation);\n        setTimeout(() => {\n          this.setData({\n            triggered: false\n          });\n        }, 2000);\n      },\n\n      getMessageList(conversation) {\n        if (!this.isCompleted) {\n          uni.$TUIKit.getMessageList({\n            conversationID: conversation.conversationID,\n            nextReqMessageID: this.nextReqMessageID,\n            count: 15\n          }).then(res => {\n            const {\n              messageList\n            } = res.data; // 消息列表。\n            this.nextReqMessageID = res.data.nextReqMessageID; // 用于续拉，分页续拉时需传入该字段。\n            this.isCompleted = res.data.isCompleted; // 表示是否已经拉完所有消息。\n            this.messageList = [...messageList, ...this.messageList];\n            this.$handleMessageRender(this.messageList, messageList);\n          });\n        }\n      },\n\n      // 自己的消息上屏\n      updateMessageList(msg) {\n        this.messageList = [...this.messageList, msg]\n        this.scrollToButtom()\n      },\n\n      // 消息已读更新\n      $onMessageReadByPeer() {\n        this.setData({\n          messageList: this.messageList\n        });\n      },\n      scrollToButtom() {\n        const query = uni.createSelectorQuery().in(this);\n        let nodesRef = query.select('#message-scroll');\n        nodesRef.boundingClientRect(res => {\n          this.$nextTick(() => {\n            //进入页面滚动到底部\n            this.scrollTop = res.height;\n          });\n        }).exec()\n      },\n      // 收到的消息\n      $onMessageReceived(value) {\n        // 若需修改消息，需将内存的消息复制一份，不能直接更改消息，防止修复内存消息，导致其他消息监听处发生消息错误\n        const event = value;\n        const list = [];\n        event.data.forEach(item => {\n          if (item.conversationID === this.conversation.conversationID) {\n            list.push(Object.assign(item));\n          }\n        });\n        this.messageList = this.messageList.concat(list);\n        this.scrollToButtom()\n      },\n\n      // 历史消息渲染\n      $handleMessageRender(messageList) {\n        if (messageList.length > 0) {\n          this.setData({\n            messageList,\n          }, () => {});\n          this.$nextTick(() => {\n            //进入页面滚动到底部\n            this.scrollTop = 9999;\n          });\n        }\n      },\n    }\n  };\n</script>\n<style>\n    @import \"./index.css\";\n</style>\n","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}