{"version":3,"sources":["webpack:////Users/elliott/Desktop/dubbingStr2.0/components/chat/message-list/index.vue?afcd","webpack:////Users/elliott/Desktop/dubbingStr2.0/components/chat/message-list/index.vue?416a","webpack:////Users/elliott/Desktop/dubbingStr2.0/components/chat/message-list/index.vue?3e77","webpack:////Users/elliott/Desktop/dubbingStr2.0/components/chat/message-list/index.vue?f99a","uni-app:///components/chat/message-list/index.vue","webpack:////Users/elliott/Desktop/dubbingStr2.0/components/chat/message-list/index.vue?30bb"],"names":["renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","l0","_self","_c","__map","messageList","item","index","$orig","__get_orig","m0","conversation","type","getcaculateTimeago","time","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","getMessageList","scrollAnimation"],"mappings":";;;;2DAAA,wQACIA,EADJ,qMASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,yCACZ,aAAAF,E;;;;2GCvBf,0yC;;;;2GCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eAETC,GADKJ,EAAIK,MAAMC,GACVN,EAAIO,MAAMP,EAAIQ,aAAa,SAASC,EAAMC,GACjD,IAAIC,EAAQX,EAAIY,WAAWH,GAEvBI,EACwB,gBAA1Bb,EAAIc,aAAaC,MAA0BL,EAAQ,GAAK,EACpDV,EAAIgB,mBAAmBP,EAAKQ,MAC5B,KACN,MAAO,CACLN,MAAOA,EACPE,GAAIA,OAIRb,EAAIkB,IAAIC,KAAOC,OAAOC,OACpB,GACA,CACEC,MAAO,CACLlB,GAAIA,MAKRmB,GAAmB,EACnBC,EAAkB,GACtBzB,EAAO0B,eAAgB,G;;;;2DC7BvB,04BAAm1B,eAAG,G;;;;0ICqDt1B,iC,q3DACA,CACE,KADF,WAEI,MAAJ,CACM,OAAN,GACM,OAAN,GAEM,YAAN,GAEM,WAAN,GACM,UAAN,EACM,WAAN,EACM,iBAAN,GAEM,aAAN,EAEM,iBAAN,EACM,aAAN,KAIE,WAAF,CACI,eAAJ,EACI,iBAAJ,EACI,iBAAJ,EACI,eAAJ,GAEE,MAAF,CACI,aAAJ,CACM,KAAN,OACM,QAAN,eAGE,MAAF,CACI,aAAJ,CACM,QAAN,uBACQ,QAAR,eACA,kBACQ,KAAR,SACU,aAAV,IACQ,WACE,EAAV,sBAGM,WAAN,EACM,MAAN,IAGE,QA/CF,WA+CA,WACI,EAAJ,yCACM,EAAN,qBACM,EAAN,wBAEI,EAAJ,yEACI,EAAJ,gFAGE,UAxDF,WA0DI,EAAJ,sEAEE,QAAF,CACI,QADJ,WACA,WAGM,GAFA,KAAN,aACM,KAAN,aACA,iBAMQ,OALA,KAAR,+BACQ,YAAR,WACU,EAAV,aACU,EAAV,eACA,KAGM,KAAN,kCACM,YAAN,WACQ,EAAR,aACQ,EAAR,eACA,MAGA,mBAnBA,SAmBA,GACA,oCAGIC,eAvBJ,SAuBA,cACA,kBACQ,EAAR,wBACU,eAAV,iBACU,iBAAV,sBACU,MAAV,KACQ,MAAR,YACU,QAAV,oCADA,IAGU,EACA,EAAV,KADA,YAEU,EAAV,yCACU,EAAV,+BACU,EAAV,6CACU,EAAV,sCAEU,EAAV,sBACY,KAAZ,uEAOI,kBA/CJ,SA+CA,GACM,KAAN,+CACM,KAAN,mBAII,qBArDJ,WAsDM,KAAN,SACQ,YAAR,oBAGI,eA1DJ,SA0DA,GAEM,KAAN,sBACA,MACU,KAAV,kBACU,KAAV,sBACYzB,KAAK0B,iBAAkB,OAGzB,KAAV,wCACU,KAAV,sBACY1B,KAAK0B,iBAAkB,UAM/B,mBA3EJ,SA2EA,cAEA,IACA,KACM,EAAN,0BACA,kDACU,EAAV,0BAGM,KAAN,uCACM,KAAN,mBAII,qBAzFJ,SAyFA,cACA,aACQ,KAAR,SACU,YAAV,IACQ,eACA,KAAR,sBAEA,qBACU,EAAV,uB;;;;2DCnNA,uvCAAgsC,eAAG,G","file":"components/chat/message-list/index.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=6eddd953&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/chat/message-list/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=6eddd953&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.messageList, function(item, index) {\n    var $orig = _vm.__get_orig(item)\n\n    var m0 =\n      _vm.conversation.type !== \"@TIM#SYSTEM\" && index % 6 == 0\n        ? _vm.getcaculateTimeago(item.time)\n        : null\n    return {\n      $orig: $orig,\n      m0: m0\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\n    <scroll-view \n\t\tclass=\"msg-list\"\n\t\tscroll-y=\"true\"\n\t\t:refresher-enabled=\"true\"\n\t\t:scroll-top=\"scrollTop\"\n\t\t:scroll-into-view=\"scrollToView\"\n\t\t:refresher-triggered=\"triggered\"\n\t\t@refresherrefresh=\"refresh\"\n\t\tupper-threshold=\"50\"\n\t>\n\t\t<view class=\"row\" v-for=\"(item,index) in messageList\" :key=\"index\" :id=\"item.ID\">\n\t\t\t<!-- 用户消息 -->\n\t\t\t<block v-if=\"conversation.type !== '@TIM#SYSTEM'\">\n\t\t\t\t<view class=\"system\">\n\t\t\t\t\t<!-- 文字消息 -->\n\t\t\t\t\t<view v-if=\"index%6==0\" class=\"text\">\n\t\t\t\t\t\t{{getcaculateTimeago(item.time)}}\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<!-- 自己发出的消息 -->\n\t\t\t\t<view :class=\"item.flow==='out'? 'my':'other'\">\n\t\t\t\t\t<!-- 左-头像 -->\n\t\t\t\t\t<view v-if=\"item.flow==='in'\" class=\"left\">\n\t\t\t\t\t\t<image :src=\"item.avatar\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<!-- 左-消息 -->\n\t\t\t\t\t<view :class=\"item.flow==='out'? 'left':'right'\">\n\t\t\t\t\t\t<!-- 文字消息 -->\n\t\t\t\t\t\t<TUI-TextMessage v-if=\"item.type === 'TIMTextElem'\" :message=\"item\" :isMine=\"item.flow==='out'\"></TUI-TextMessage>\n\t\t\t\t\t\t<TUI-CustomMessage v-if=\"item.type === 'TIMCustomElem'\" :message=\"item\" :isMine=\"item.flow==='out'\"></TUI-CustomMessage>\n\t\t\t\t\t\t<!-- 领取红包消息 -->\n\t\t\t\t\t</view>\n\t\t\t\t\t<!-- 右-头像 -->\n\t\t\t\t\t<view v-if=\"item.flow==='out'\" class=\"right\">\n\t\t\t\t\t\t<image :src=\"item.avatar\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"system\">\n\t\t\t\t  <view v-if=\"item.payload.data=='offer'\" class=\"red-envelope\">\n\t\t\t\t\t【平台提醒】先填写请求报价单，配音效率会\n\t\t\t\t  </view>\n\t\t\t\t</view>\n\t\t\t</block>\n\t\t</view>\n\t</scroll-view>\n</template>\n\n<script>\n  import TUITextMessage from \"../message-elements/text-message/index\";\n  import TUICustomMessage from \"../message-elements/custom-message/index\";\n  import TUISystemMessage from \"../message-elements/system-message/index\";\n  import TUIFileMessage from \"../message-elements/file-message/index\";\n  import { caculateTimeago } from '@/utils/common';\n  export default {\n    data() {\n      return {\n        avatar: '',\n        userID: '',\n        // 当前会话\n        messageList: [],\n        // 自己的 ID 用于区分历史消息中，哪部分是自己发出的\n        scrollView: '',\n        scrollTop: 0,\n        triggered: false,\n        nextReqMessageID: '',\n        // 下一条消息标志\n        isCompleted: false, // 当前会话消息是否已经请求完毕\n        // 滚动动画\n        scrollAnimation:false,\n        scrollToView: ''\n      };\n    },\n\n    components: {\n      TUITextMessage,\n      TUICustomMessage,\n      TUISystemMessage,\n      TUIFileMessage\n    },\n    props: {\n      conversation: {\n        type: Object,\n        default: () => {}\n      }\n    },\n    watch: {\n      conversation: {\n        handler: function (newVal) {\n          console.log('传过来的值', newVal)\n          if (!newVal.conversationID) return;\n          this.setData({\n            conversation: newVal\n          }, () => {\n            this.getMessageList(newVal);\n          });\n        },\n        immediate: true,\n        deep: true\n      }\n    },\n    mounted() {\n      uni.$TUIKit.getMyProfile().then(res => {\n        this.avatar = res.data.avatar;\n        this.userID = res.data.userID;\n      });\n      uni.$TUIKit.on(uni.$TUIKitEvent.MESSAGE_RECEIVED, this.$onMessageReceived, this);\n      uni.$TUIKit.on(uni.$TUIKitEvent.MESSAGE_READ_BY_PEER, this.$onMessageReadByPeer, this);\n    },\n\n    destroyed() {\n      // 一定要解除相关的事件绑定\n      uni.$TUIKit.off(uni.$TUIKitEvent.MESSAGE_RECEIVED, this.$onMessageReceived);\n    },\n    methods: {\n      refresh() {\n        this.triggered = true\n        this._freshing = true\t \n        if (this.isCompleted) {\n          this.setData({isCompleted: true,});\n          setTimeout(() => {\n              this.triggered = false\n              this._freshing = false\n              }, 1000);\n              return;\n          }\n          this.getMessageList(this.conversation);\n            setTimeout(() => {\n              this.triggered = false\n              this._freshing = false\n          }, 1000);\n      },\n       //  时间戳转换 \n\t  getcaculateTimeago(item) {\n\t\t  return caculateTimeago(item * 1000);\n\t  },\n    // 获取配音师消息\n    getMessageList(conversation) {\n        if (!this.isCompleted) {\n          uni.$TUIKit.getMessageList({\n            conversationID: conversation.conversationID,\n            nextReqMessageID: this.nextReqMessageID,\n            count: 15\n          }).then(res => {\n            console.log('配音师列表数据', res, res.data.isCompleted)\n            const {\n              messageList\n            } = res.data; // 消息列表。\n            this.nextReqMessageID = res.data.nextReqMessageID; // 用于续拉，分页续拉时需传入该字段。\n            this.isCompleted = res.data.isCompleted; // 表示是否已经拉完所有消息。\n            this.messageList = [...messageList, ...this.messageList];\n            this.$handleMessageRender(this.messageList, messageList);\n            //这段代码很重要，不然每次加载历史数据都会跳到顶部\n            this.$nextTick(function() {\n              this.scrollToView = res.data.messageList[res.data.messageList.length-1].ID;//跳转上次的第一行信息位置\n            });\n          });\n        }\n      },\n\n      // 自己的消息上屏\n      updateMessageList(msg) {\n        this.messageList = [...this.messageList, msg]\n        this.scrollToButtom(msg)\n      },\n\n      // 消息已读更新\n      $onMessageReadByPeer() {\n        this.setData({\n          messageList: this.messageList\n        });\n      },\n      scrollToButtom(msg) {\n        //这段代码很重要，不然每次加载历史数据都会跳到顶部\n        this.$nextTick(function() {\n          if (msg.ID) {\n            this.scrollToView = msg.ID;//跳转上次的第一行信息位置\n            this.$nextTick(function() {\n            this.scrollAnimation = true;//恢复滚动动画\n            });\n          } else {\n            this.scrollToView = msg.data[msg.data.length-1].ID;//跳转上次的第一行信息位置\n            this.$nextTick(function() {\n            this.scrollAnimation = true;//恢复滚动动画\n            });\t\n          }\n        });\n      },\n      // 收到的消息\n      $onMessageReceived(value) {\n        // 若需修改消息，需将内存的消息复制一份，不能直接更改消息，防止修复内存消息，导致其他消息监听处发生消息错误\n        const event = value;\n        const list = [];\n        event.data.forEach(item => {\n          if (item.conversationID === this.conversation.conversationID) {\n            list.push(Object.assign(item));\n          }\n        });\n        this.messageList = this.messageList.concat(list);\n        this.scrollToButtom(value)\n      },\n\n      // 历史消息渲染\n      $handleMessageRender(messageList) {\n        if (messageList.length > 0) {\n          this.setData({\n            messageList,\n          }, () => {});\n          this.$nextTick(() => {\n            //进入页面滚动到底部\n\t\t       \tconsole.log('走这里了吗')\n            this.scrollTop = 99999;\n          });\n        }\n      },\n    }\n  };\n</script>\n<style>\n    @import \"./index.css\";\n</style>\n","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}